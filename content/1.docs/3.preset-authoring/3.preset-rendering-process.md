---
title: Rendering Process
description: All built-in effects and their rendering order.
---

## Preset Versions

Before listing all effects, it's important to know the differences between preset versions.

In general, presets are different between Milkdrop 1.x and Milkdrop 2.x. This is because Milkdrop 1 did not support
using pixel shaders, they only supported a fixed set of effects which could be controlled using certain predefined
parameters.

Milkdrop 2.0 introduced shader support and since Milkdrop 2.0.1, preset authors could choose to use different shader
versions for both warp and composite shaders (or disable them individually).

As a rule of thumb, all Milkdrop 1 post-processing effects listed below will be disabled if a user-defined composite
shader is enabled.

## Preset Loading

When loading a preset, all `init` expression code blocks will be executed _once_, in this order:

- `per_frame_init`
- `wave_0_init`
- `wave_1_init`
- `wave_2_init`
- `wave_3_init`
- `shape_0_init`
- `shape_1_init`
- `shape_2_init`
- `shape_3_init`

## Rendering Order

The following sections lists all Milkdrop built-in effects in the order they're being rendered. The rendering order is
important to achieve certain effects.

Each effect is described in more detail in the [following chapter](effects).

### Frame Setup

This step doesn't render anything, but executes the `per_frame_` code block.

### Motion Vector Grid

Draws a grid of colored dots or lines on top of the previous frame's image. The lines represent the apparent motion (
speed and direction) of the warp effect.

Not that this is the only effect which is drawn _before_ warping the image.

### Image Warp

A full-screen effect which allows to transform the previous frame's image in many different ways. This effect consists
of multiple steps:

1. For each intersection in the user-defined warp mesh grid, the "per-vertex" or "per-pixel" expression code is
   executed.
2. If the preset version is less than `200` or the warp pixel shader version less than `2`, a simple default warp shader
   will be used. This shader also applies the `decay` value by multiplying the resulting color with the set value.
3. Otherwise, the warp shader contained in the preset will be executed and rendered. It may or may not use the warp grid
   U/V coordinates. The `decay` value will not be applied automatically.

### Custom Shapes

A preset may use up to 4 sets of custom shapes, each with 1 to 1024 instances. Shapes 1 to 4 are rendered in order and
thus on top of each other.

Each shape instance can have a colored or textured interior, and also an optional colored border around it.

### Custom Waveforms

Custom waveforms, of which up to 4 can be used, render lines or dots and can use audio or spectrum data to animate the
waveform.

The coordinates and color of each individual point which makes up the waveform can be scripted using expression code.
This allows to draw arbitrary shapes.

### Default Waveform

A single waveform with eight predefined drawing modes. The mode, color, position and scaling of the waveform can be
customized.

### Darken Center

A simple effect which draws a diamond-shaped area in the center of the screen which darkens pixels more the closer they
are to the center.

### Image Borders

Two configurable borders around the whole screen, one inner and one outer border. Each can have individual color and
width.

### Post-Processing / Composite Effect(s)

Before any post-processing effects are applied, the current preset image is stored and passed on to the next frame. This
means any of the effects described in this section are only display to the viewer and the image will then be discarded.

If the preset version is at least `200` (Milkdrop 2.0) and a pixel shader version >= 2 is set for the composite shader,
only the "Composite Shader" effect is drawn and the other effects below are skipped.

If no composite shader is enabled as stated above, the five "classic" post-processing filters are drawn if enabled
individually.

#### Composite Shader

The composite shader can contain arbitrary HLSL code.

If the preset contains composite shader code, the shader is executed to draw the final image. none of the following
effects will be applied in this case.

#### Video Echo

Renders a copy of the current preset image ofer the existing one. The image can be flipped on the X and Y axis and
zoomed in or out. The opacity of the effect can also be specified from 0% (effect disabled) to 100% (only rendering the
echo).

#### Brighten Image

Brightens the whole image using a square filter.

#### Darken Image

Darkens the whole image using a square filter.

#### Solarize

Emphasizes medium-bright colors of the image.

#### Gamma Adjustment

Applies a gamma filter, eventually multiple times, to adjust the overall image brightness.
