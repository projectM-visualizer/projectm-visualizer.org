---
title: Motion-Vector Grid
description: A configurable grid with dots or lines following the warp motion.
---

![Motion Vectors Effect](/content/preset-guide/effect-motion-vectors.jpg){style="width: 50%;"}

The Motion Vector Grid is the very first effect being drawn, even before the [Warp effect](image-warp) is applied.

The effect draws a grid of lines (or dots, if length is set to minimum). The lines resemble the reverse-propagated
motion vectors of the Warp effect as drawn in the _previous_ frame, pointing into the direction of movement, with the
line length representing the movement speed.

## Default Settings

In the preset file, the following settings configure the default values for the Motion Vector Grid effect:

| .milk Setting Key | Type  | Range       | Description                                                              |
|-------------------|-------|-------------|--------------------------------------------------------------------------|
| nMotionVectorsX   | INT   | 0 .. 64     | The number of motion vectors in the X direction                          |
| nMotionVectorsY   | INT   | 0 .. 48     | The number of motion vectors in the Y direction                          |
| mv_dx             | FLOAT | -1.0 .. 1.0 | Horizontal placement offset of the motion vectors                        |
| mv_dy             | FLOAT | -1.0 .. 1.0 | Vertical placement offset of the motion vectors                          |
| mv_l              | FLOAT | 0.0 .. 5.0  | The length of the motion vectors (0=dot/no trail, 1=normal, 2=double...) |
| mv_r              | FLOAT | 0.0 .. 1.0  | The red color value of the motion vector grid                            |
| mv_g              | FLOAT | 0.0 .. 1.0  | The green color value of the motion vector grid                          |
| mv_b              | FLOAT | 0.0 .. 1.0  | The blue color value of the motion vector grid                           |
| mv_a              | FLOAT | 0.0 .. 1.0  | The opacity of the motion vector grid                                    |

## Expression Code Usage

All settings of the Motion Vector Grid can be manipulated using Milkdrop expression code using the variables described
below in one of the following blocks:

- `per_frame_init_`
- `per_frame_`

| .milk Setting Key | Expression Variable | Writeable |
|-------------------|---------------------|-----------|
| nMotionVectorsX   | mv_x                | YES       |
| nMotionVectorsY   | mx_y                | YES       |
| mv_dx             | mv_dx               | YES       |
| mv_dy             | mv_dy               | YES       |
| mv_l              | mv_l                | YES       |
| mv_r              | mv_r                | YES       |
| mv_g              | mv_g                | YES       |
| mv_b              | mv_b                | YES       |
| mv_a              | mv_a                | YES       | 

**Notes:**

- Values are not retained across frames, they're only used to draw the current frame and then discarded.
- Each value will be set to the default value assigned in the .milk file at the start of each of the above code blocks.
- Any changes made to the variables in the `per_frame_init_` code are discarded and reset to defaults in the
  `per_frame_` block.

This means:

- Only read the values in the `per_frame_init_` bock, e.g. to init user-defined or global variables.
- An expression like `mv_dx += 0.01;` will not animate the value, it'll instead add a constant value to the default one.
