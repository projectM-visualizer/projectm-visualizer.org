---
title: Functions
description: Built-in functions.
---

The following functions can be used in Milkdrop preset expression code blocks.

Note that some functions such as `exec2`/`exec3`, `loop` and `while` were introduced in later Milkdrop releases. Since
it is now assumed everyone is using a recent Milkdrop/projectM version or derivate, there is no specific note on
availability for each function.

### above(left, right)

Returns `1` if `left` has a larger value than `right`, otherwise `0`.

Same as the `>` operator.

### abs(val)

Returns the absolute (positive) value of `val`.

### acos(val)

Calculates and returns the arc cosine (inverse cosine) of `val`. The angle is interpreted as radians.

### asin(val)

Calculates and returns the arc sine (inverse sine) of `val`. The angle is interpreted as radians.

### assign(dest, val)

Assign `val` to the reference pointed by `dest` and return `dest`. If `dest` is not a reference, the result is the
_value_ of `val`.

Same as the assignment operator `=`.

### atan(val)

Calculates and returns the arc tangent (inverse tangent) of `val`. The angle is interpreted as radians.

### atan2(x, y)

Calculates and returns the polar coordinate angle associated with the coordinate represented by `x,y`. The angle is
returned as radians.

See the [Wikipedia definition of atan2](https://en.wikipedia.org/wiki/Atan2) for details.

### band(left, right)

Evaluates both arguments and returns `1` if both arguments evaluate to a non-zero value and `0` if at least one argument
is zero.

Note: The boolean AND operator `&&` returns the same result, but only evaluates the second argument if the first one is
not zero!

### below(left, right)

Returns `1` if `left` has a smaller value than `right`, otherwise `0`.

Same as the `<` operator.

### bnot(val)

Boolean NOT operator. Returns `1` if `val` is `0`, otherwise `0`.

Same as the `!` operator.

### bor(left, right)

Evaluates both arguments and returns `1` if at least one argument evaluates to a non-zero value and `0` if both
arguments are zero.

Note: The boolean OR operator `||` returns the same result, but only evaluates the second argument if the first one is
zero!

### ceil(val)

Rounds the value of `val` to the next _larger_ integer number in reference to `0`.

### cos(val)

Calculates and returns the cosine of `val`. The angle is interpreted as radians.

### equal(left, right)

Compares both values and returns `1` of they are equal or `0`if not.

Same as the `==` operator.

### exec2(expr1, expr2)

Executes both expressions and returns the result of the second one.

### exec3(expr1, expr2, expr3)

Executes all three expressions in order and returns the result of the third one.

### exp(val)

Exponential function with base `e` to the power of `val`.

Equivalent to the expression `$E ^ val`.

### floor(val)

Rounds the value of `val` to the next _smaller_ integer number in reference to `0`.

### freembuf(index)

Requests freeing all memory blocks in `megabuf` (NOT `gmegabuf`) beginning with the block `index` is in. This may result
in memory being freed before the given index.

**Note:** This function is currently a no-op in both Milkdrop and projectM. It does _not_ actually free any memory or
reset the memory contents.

Memory blocks are 65536 entries large, and there is a total of 128 blocks.

### gmegabuf(index)

Returns a reference to the storage location of `index` in the global memory buffer.

Any memory index from 0 to 8.388.607 (= 128 * 65536) can be addressed. Any index outside of this range will return the
fixed _value_ `0`, and no memory is changed when assigning another value to it.

### if(cond, trueval, falseval)

Evaluates `cond`, and returns `trueval` if the result is non-zero. Otherwise, `falseval` is returned.

If either `trueval` or `falseval` evaluate to a reference, the reference is passed through. Thus, assigning a value to
the result of `if()` is possible:

`if(x > 5, a, b) = 10;` will assign `10` to `a`  if `x > 5` and to `b` if `x <= 5`.

### int(val)

Truncates any decimals from `val`, effectively converting it into an integer.

### invsqrt(val)

Calculates the [fast inverse square root](https://en.wikipedia.org/wiki/Fast_inverse_square_root) of `val`.

### log(val)

Calculates and returns the ("natural") logarithm to base `e` of `val`.

### log10

Calculates and returns the logarithm to base 10 of `val`.

### loop(count, expr)

Executes `expr` exactly `count` times.

As mentioned in the grammar section, `expr` can also consist of multiple expressions separated by semicolon. this is
also true for `count`, but expressions in this argument are only evaluated once before the first loop iteration starts.

The loop will always abort after 2^20 (~1 million) iterations.

Be careful when nesting loops, as the loop count and associated run time will grow exponentially with each nesting
level, which can hang up the application.

### max(val1, val2)

Returns the larger of the two _values_ of `val1` and `val2`.

### megabuf(index)

Returns a reference to the storage location of `index` in the local memory buffer.

Any memory index from 0 to 8.388.607 (= 128 * 65536) can be addressed. Any index outside of this range will return the
fixed _value_ `0`, and no memory is changed when assigning another value to it.

### memcpy(dest, src, count)

Copies `count` values starting at `src` to `dest`. Returns a reference to `dest`.

Memory areas are allowed to overlap.

Any source or destination memory falls outside the allowed indices of 0 to 8.388.607, the range is trimmed accordingly
and only a data block is copied that fits into both areas.

### memset(dest, value, count)

Fills `count` number of memory slots beginning at `dest` with `value`.

If the range falls outside the allowed indices of 0 to 8.388.607, the range is trimmed accordingly.

This function is _way_ faster than setting individual values to 0 in a `loop()` and should be preferred if a larger
memory block needs to be initialized or reset with a single number.

### min(val1, val2)

Returns the smaller of the two _values_ of `val1` and `val2`.

### pow(base, exp)

Calculates `base` to the power of `exp` and returns the resulting value.

### rand(max)

Calculates a pseudo-random number (using the Mersenne-Twister algorithm) between 0 and `max`.

`max` can be a floating-point value.

### sigmoid(a, b)

Calculates the logistic curve with an argument of `(-a * b)` and returns the result.

This is equivalent to the expression `tmp = 1 + pow($E, (-a + b)); if(tmp > 0.00001, 1 / tmp, 0);`.

### sign(val)

Returns the signage of `val`, which is `-1` for negative values, `1` for positive values and `0` for `0`.

### sin

Calculates and returns the sine of `val`. The angle is interpreted as radians.

### sqr(val)

Calculates and returns the square of `val`.

This is equivalent to the expression `val * val`.

### sqrt(val)

Calculates and returns the square root of `val`.

### tan(val)

Calculates and returns the tangent of `val`. The angle is interpreted as radians.

### while(expr)

Executes `expr` at least once and loops until it returns `0`.

`expr` can be a semicolon-separated list of expressions. Only the return value of the last expression in the list is
used to determine the loop abort condition.

The loop will always abort after 2^20 (~1 million) iterations.

Be careful when nesting loops, as the loop count and associated run time will grow exponentially with each nesting
level, which can hang up the application.
